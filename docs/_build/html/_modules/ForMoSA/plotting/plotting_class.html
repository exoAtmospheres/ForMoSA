<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ForMoSA.plotting.plotting_class &mdash; ForMoSA 2.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=51b770b3"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ForMoSA
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../demo.html">DEMO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">ForMoSA API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ForMoSA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">ForMoSA.plotting.plotting_class</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for ForMoSA.plotting.plotting_class</h1><div class="highlight"><pre>
<span></span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">corner</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="c1"># Import ForMoSA</span>
<span class="kn">from</span> <span class="nn">main_utilities</span> <span class="kn">import</span> <span class="n">GlobFile</span>
<span class="kn">from</span> <span class="nn">nested_sampling.nested_modif_spec</span> <span class="kn">import</span> <span class="n">modif_spec</span>
<span class="kn">from</span> <span class="nn">nested_sampling.nested_modif_spec</span> <span class="kn">import</span> <span class="n">doppler_fct</span>
<span class="kn">from</span> <span class="nn">nested_sampling.nested_modif_spec</span> <span class="kn">import</span> <span class="n">lsq_fct</span>
<span class="kn">from</span> <span class="nn">nested_sampling.nested_modif_spec</span> <span class="kn">import</span> <span class="n">vsini_fct_accurate</span>
<span class="kn">from</span> <span class="nn">adapt.extraction_functions</span> <span class="kn">import</span> <span class="n">resolution_decreasing</span><span class="p">,</span> <span class="n">adapt_model</span><span class="p">,</span> <span class="n">decoupe</span>
<span class="kn">from</span> <span class="nn">adapt.extraction_functions</span> <span class="kn">import</span> <span class="n">adapt_observation_range</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_pdf</span> <span class="kn">import</span> <span class="n">PdfPages</span>



<div class="viewcode-block" id="bin_data">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.bin_data">[docs]</a>
<span class="k">def</span> <span class="nf">bin_data</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to bin data given a bin size</span>

<span class="sd">    Args:</span>
<span class="sd">        wave         (array): wavelength of the data</span>
<span class="sd">        data         (array): data</span>
<span class="sd">        bin_size       (int): size of the bin to apply</span>

<span class="sd">    Returns:</span>
<span class="sd">        wave_binned  (array): binned wavelength</span>
<span class="sd">        data_binned  (array): binned data</span>

<span class="sd">    Author: Allan Denis</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># First quick check that len of data is a multpiple of bin_size</span>
    <span class="k">while</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">%</span><span class="n">bin_size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">wave</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">wave</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">),</span> <span class="n">bin_size</span><span class="p">)</span>
    <span class="n">wave_binned</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">reduceat</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span> <span class="o">/</span> <span class="n">bin_size</span>
    <span class="n">data_binned</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">reduceat</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span> 
    
    <span class="k">return</span> <span class="n">wave_binned</span><span class="p">,</span> <span class="n">data_binned</span></div>

    
    

<span class="c1"># ----------------------------------------------------------------------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="ComplexRadar">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.ComplexRadar">[docs]</a>
<span class="k">class</span> <span class="nc">ComplexRadar</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class to create Radar plots with asymmetric error bars.</span>

<span class="sd">    Author: Paulina Palma-Bifani</span>
<span class="sd">            Adapted from Damian Cummins: https://github.com/DamianCummins/statsbomb-football-event-visualisations/blob/master/Statsbomb%20Womens%20World%20Cup%202019%20visualisation.ipynb</span>
<span class="sd">   </span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">ranges</span><span class="p">,</span> <span class="n">n_ordinate_levels</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize class.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            fig               (object): matplotlib figure object</span>
<span class="sd">            variables           (list): list of parameters to plot</span>
<span class="sd">            ranges       (list(tuple)): upper and lower limits for each parameters</span>
<span class="sd">            n_ordinate_levels    (int): (default = 6) number of gridlines in the plot</span>
<span class="sd">        Returns:</span>
<span class="sd">            None   </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mf">360.</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">))</span>

        <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.9</span><span class="p">],</span> <span class="n">polar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;axes</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">))]</span>

        <span class="n">l</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_thetagrids</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">variables</span><span class="p">)</span>

        <span class="p">[[</span><span class="n">txt</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">),</span>
              <span class="n">txt</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
              <span class="n">txt</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">))]</span> <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="n">text</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">ranges</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="n">n_ordinate_levels</span><span class="p">)</span>
            <span class="n">gridlabel</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">grid</span><span class="p">]</span>

            <span class="n">gridlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1"># clean up origin</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_rgrids</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">gridlabel</span><span class="p">,</span><span class="n">angle</span><span class="o">=</span><span class="n">angles</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">*</span><span class="n">ranges</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        
        <span class="c1"># variables for plotting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">angles</span><span class="p">,</span> <span class="n">angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span> <span class="o">=</span> <span class="n">ranges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<div class="viewcode-block" id="ComplexRadar.plot">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.ComplexRadar.plot">[docs]</a>
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to display the plot.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            data       (list): best value for each parameter</span>
<span class="sd">            *args           : Variable length argument list.</span>
<span class="sd">            **kw            : Arbitrary keyword arguments.</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">sdata</span><span class="p">,</span> <span class="n">sdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="ComplexRadar.fill">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.ComplexRadar.fill">[docs]</a>
    <span class="k">def</span> <span class="nf">fill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add symmetric error bars to the plot.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            data       (list): best value for each parameter</span>
<span class="sd">            *args           : Variable length argument list.</span>
<span class="sd">            **kw            : Arbitrary keyword arguments.</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sdata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">sdata</span><span class="p">,</span> <span class="n">sdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="ComplexRadar.fill_between">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.ComplexRadar.fill_between">[docs]</a>
    <span class="k">def</span> <span class="nf">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_down</span><span class="p">,</span> <span class="n">list_up</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add asymmetric error bars to the plot.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            list_down (list): list of lower error bars</span>
<span class="sd">            list_up   (list): list of upper error bars</span>
<span class="sd">            *args           : Variable length argument list.</span>
<span class="sd">            **kw            : Arbitrary keyword arguments.</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sdata_down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_data</span><span class="p">(</span><span class="n">list_down</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">)</span>
        <span class="n">sdata_up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_data</span><span class="p">(</span><span class="n">list_up</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">sdata_down</span><span class="p">,</span><span class="n">sdata_down</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">sdata_up</span><span class="p">,</span><span class="n">sdata_up</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="ComplexRadar.scale_data">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.ComplexRadar.scale_data">[docs]</a>
    <span class="k">def</span> <span class="nf">scale_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ranges</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to check that lower and upper limits are correctly ordered. It scales data[1:] to ranges[0]</span>

<span class="sd">        Args:</span>
<span class="sd">            data              (list): best value for each parameter</span>
<span class="sd">            ranges     (list(tuple)): upper and lower limits for each parameters</span>
<span class="sd">            *args           : Variable length argument list.</span>
<span class="sd">            **kw            : Arbitrary keyword arguments.</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">y1</span> <span class="o">&lt;=</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="n">y2</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y2</span> <span class="o">&lt;=</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="n">y1</span><span class="p">)</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="k">if</span> <span class="n">y1</span> <span class="o">&gt;</span> <span class="n">y2</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">_invert</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">))</span>
                <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y1</span>
            <span class="n">sdata</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">d</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="n">x1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sdata</span></div>
</div>




<span class="c1"># ----------------------------------------------------------------------------------------------------------------------</span>
<span class="c1"># ----------------------------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="PlottingForMoSA">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.PlottingForMoSA">[docs]</a>
<span class="k">class</span> <span class="nc">PlottingForMoSA</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class containing all the plotting functionalities of ForMoSA.</span>

<span class="sd">    Author: Paulina Palma-Bifani, Simon Petrus, Matthieu Ravet and Allan Denis</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file_path</span><span class="p">,</span> <span class="n">color_out</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize class by inheriting the global parameter class of ForMoSA.</span>

<span class="sd">        Args:</span>
<span class="sd">            config_file_path   (str): path to the config.ini file currently used</span>
<span class="sd">            color_out          (str): color to use for the model</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span> <span class="o">=</span> <span class="n">GlobFile</span><span class="p">(</span><span class="n">config_file_path</span><span class="p">)</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">color_out</span>     <span class="o">=</span> <span class="n">color_out</span>


    <span class="k">def</span> <span class="nf">_get_posteriors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to get the posteriors, including luminosity derivation and Bayesian evidence logz.</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>
<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">result_path</span> <span class="o">+</span> <span class="s1">&#39;/result_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">ns_algo</span> <span class="o">+</span> <span class="s1">&#39;.pic&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">open_pic</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">open_pic</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">]</span>

        <span class="c1"># To test the quality of the fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logl</span><span class="o">=</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;logl&#39;</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logl</span><span class="o">==</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logl</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_best</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sample_logz</span>    <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;logz&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample_logzerr</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;logz&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs_string</span> <span class="o">=</span> <span class="s1">&#39;logz = &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_logz</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; Â± &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_logzerr</span><span class="p">)</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">model_path</span><span class="p">,</span> <span class="n">decode_cf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;netcdf4&#39;</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">attrs</span>
        <span class="n">extra_parameters</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(R$\mathrm{_</span><span class="si">{Jup}</span><span class="s1">}$)&#39;</span><span class="p">],</span>
                            <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;(pc)&#39;</span><span class="p">],</span>
                            <span class="p">[</span><span class="sa">r</span><span class="s1">&#39;$\alpha$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\alpha$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
                            <span class="p">[</span><span class="s1">&#39;rv&#39;</span><span class="p">,</span> <span class="s1">&#39;RV&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(km.s$\mathrm{^{-1}}$)&#39;</span><span class="p">],</span>
                            <span class="p">[</span><span class="s1">&#39;av&#39;</span><span class="p">,</span> <span class="s1">&#39;Av&#39;</span><span class="p">,</span> <span class="s1">&#39;(mag)&#39;</span><span class="p">],</span>
                            <span class="p">[</span><span class="s1">&#39;vsini&#39;</span><span class="p">,</span> <span class="s1">&#39;v.sin(i)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(km.s$\mathrm{^{-1}}$)&#39;</span><span class="p">],</span>
                            <span class="p">[</span><span class="s1">&#39;ld&#39;</span><span class="p">,</span> <span class="s1">&#39;limb darkening&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
                            <span class="p">[</span><span class="s1">&#39;bb_T&#39;</span><span class="p">,</span> <span class="s1">&#39;bb_T&#39;</span><span class="p">,</span> <span class="s1">&#39;(K)&#39;</span><span class="p">],</span>
                            <span class="p">[</span><span class="s1">&#39;bb_R&#39;</span><span class="p">,</span> <span class="s1">&#39;bb_R&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;(R$\mathrm{_</span><span class="si">{Jup}</span><span class="s1">}$)&#39;</span><span class="p">]</span>
                            <span class="p">]</span>

        <span class="n">tot_list_param_title</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">theta_index</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">par1</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
            <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;par1&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">par2</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
            <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;par2&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">par3</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
            <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;par3&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">par4</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
            <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;par4&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">par5</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
            <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;par5&#39;</span><span class="p">)</span>

        <span class="c1"># Extra-grid parameters</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">r</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span>
            <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extra_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">extra_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">d</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span>
            <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extra_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">extra_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - - -</span>
                
        <span class="c1"># Individual parameters / observation</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span> <span class="c1"># If you want separate alpha for each observations</span>
            <span class="n">main_obs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">main_observation_path</span>
            <span class="k">for</span> <span class="n">indobs</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">main_obs_path</span><span class="p">))):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="n">indobs</span><span class="o">*</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="n">indobs</span><span class="o">*</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span> <span class="c1"># Check if the idobs is different from constant</span>
                    <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extra_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="sa">fr</span><span class="s1">&#39;$_</span><span class="si">{</span><span class="n">indobs</span><span class="si">}</span><span class="s1">$&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">extra_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;alpha_</span><span class="si">{</span><span class="n">indobs</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># If you want 1 common alpha for all observations</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">alpha</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">alpha</span> <span class="o">!=</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span>
                <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extra_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">extra_parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">rv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span> <span class="c1"># If you want separate rv for each observations</span>
            <span class="n">main_obs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">main_observation_path</span>
            <span class="k">for</span> <span class="n">indobs</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">main_obs_path</span><span class="p">))):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">rv</span><span class="p">[</span><span class="n">indobs</span><span class="o">*</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">rv</span><span class="p">[</span><span class="n">indobs</span><span class="o">*</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span> <span class="c1"># Check if the idobs is different from constant</span>
                    <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extra_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="sa">fr</span><span class="s1">&#39;$_</span><span class="si">{</span><span class="n">indobs</span><span class="si">}</span><span class="s1">$&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">extra_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rv_</span><span class="si">{</span><span class="n">indobs</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># If you want 1 common rv for all observations</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">rv</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">rv</span> <span class="o">!=</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span>
                <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extra_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">extra_parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;rv&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">vsini</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span> <span class="c1"># If you want separate vsini for each observations</span>
            <span class="n">main_obs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">main_observation_path</span>
            <span class="k">for</span> <span class="n">indobs</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">main_obs_path</span><span class="p">))):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">vsini</span><span class="p">[</span><span class="n">indobs</span><span class="o">*</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">vsini</span><span class="p">[</span><span class="n">indobs</span><span class="o">*</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span> <span class="c1"># Check if the idobs is different from constant</span>
                    <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extra_parameters</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="sa">fr</span><span class="s1">&#39;$_</span><span class="si">{</span><span class="n">indobs</span><span class="si">}</span><span class="s1">$&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">extra_parameters</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;vsini_</span><span class="si">{</span><span class="n">indobs</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># If you want 1 common vsini for all observations</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">vsini</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">vsini</span> <span class="o">!=</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span>
                <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extra_parameters</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">extra_parameters</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;vsini&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">ld</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span> <span class="c1"># If you want separate ld for each observations</span>
            <span class="n">main_obs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">main_observation_path</span>
            <span class="k">for</span> <span class="n">indobs</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">main_obs_path</span><span class="p">))):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">ld</span><span class="p">[</span><span class="n">indobs</span><span class="o">*</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">ld</span><span class="p">[</span><span class="n">indobs</span><span class="o">*</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span> <span class="c1"># Check if the idobs is different from constant</span>
                    <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extra_parameters</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="sa">fr</span><span class="s1">&#39;$_</span><span class="si">{</span><span class="n">indobs</span><span class="si">}</span><span class="s1">$&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">extra_parameters</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ld_</span><span class="si">{</span><span class="n">indobs</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># If you want 1 common vsini for all observations</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">ld</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">ld</span> <span class="o">!=</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span>
                <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extra_parameters</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">extra_parameters</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;ld&#39;</span><span class="p">)</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - - -</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">av</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">av</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span>
            <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extra_parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">extra_parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;av&#39;</span><span class="p">)</span>
        <span class="c1">## cpd bb</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">bb_T</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">bb_T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span>
            <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extra_parameters</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">extra_parameters</span><span class="p">[</span><span class="mi">7</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;bb_T&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">bb_R</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">bb_R</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span>
            <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extra_parameters</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">extra_parameters</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">theta_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;bb_R&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">theta_index</span><span class="p">)</span>

        <span class="n">posterior_to_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">r</span> <span class="o">!=</span> <span class="s1">&#39;NA&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span>
            <span class="n">posterior_to_plot</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tot_list_param_title</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;log(L/L$\mathrm{_{\odot}}$)&#39;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">res</span><span class="p">,</span> <span class="n">results</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">):</span> 
                <span class="n">ind_theta_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_index</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">r_picked</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">ind_theta_r</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                
                <span class="n">lum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">r_picked</span> <span class="o">*</span> <span class="mf">69911000.</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">5.670e-8</span> <span class="o">/</span> <span class="mf">3.83e26</span><span class="p">)</span>
                <span class="c1">#print(lum)</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">results</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lum</span><span class="p">)))</span>
                <span class="c1">#print(results)</span>
                <span class="n">posterior_to_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">posterior_to_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">posterior_to_plot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">posteriors_names</span> <span class="o">=</span> <span class="n">tot_list_param_title</span>


<div class="viewcode-block" id="PlottingForMoSA.plot_corner">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.PlottingForMoSA.plot_corner">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_corner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">levels_sig</span><span class="o">=</span><span class="p">[</span><span class="mf">0.997</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.68</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">quantiles</span><span class="o">=</span><span class="p">(</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">),</span> <span class="n">burn_in</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to display the corner plot</span>

<span class="sd">        Args:</span>
<span class="sd">            levels_sig    (list): (default = [0.997, 0.95, 0.68]) 1, 2 and 3 sigma contour levels of the corner plot</span>
<span class="sd">            bins           (int): (default = 100) number of bins for the posteriors</span>
<span class="sd">            quantiles     (list): (default = (0.16, 0.5, 0.84)) mean +- sigma to report the posterior values</span>
<span class="sd">            burn_in        (int): (default = 0) number of steps to remove from the plot</span>
<span class="sd">        Returns:</span>
<span class="sd">            fig         (object): matplotlib figure object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ForMoSA - Corner plot&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_get_posteriors</span><span class="p">()</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">posterior_to_plot</span><span class="p">[</span><span class="n">burn_in</span><span class="p">:],</span>
                            <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">burn_in</span><span class="p">:],</span>
                            <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">posteriors_names</span><span class="p">,</span>
                            <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mf">0.999999</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">posteriors_names</span><span class="p">],</span>
                            <span class="n">levels</span><span class="o">=</span><span class="n">levels_sig</span><span class="p">,</span>
                            <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                            <span class="n">smooth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">quantiles</span><span class="o">=</span><span class="n">quantiles</span><span class="p">,</span>
                            <span class="n">top_ticks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">plot_datapoints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">plot_density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">plot_contours</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">fill_contours</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">show_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">title_fmt</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">,</span>
                            <span class="n">title_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">),</span>
                            <span class="n">contour_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.7</span><span class="p">),</span>
                            <span class="n">pcolor_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">),</span>
                            <span class="n">label_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">))</span>
    

        <span class="n">fig</span><span class="o">.</span><span class="n">supxlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs_string</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>



<div class="viewcode-block" id="PlottingForMoSA.plot_chains">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.PlottingForMoSA.plot_chains">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_chains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">15</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plot to check the convergence of the posterior chains.</span>
<span class="sd">        Multiple (sub-)axis plot.</span>

<span class="sd">        Args:</span>
<span class="sd">            figsize     (tuple): (default = (7, 15)) size of the plot</span>
<span class="sd">        Returns:</span>
<span class="sd">            fig, axs    (object, object): matplotlib figure and axes objects</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ForMoSA - Posteriors chains for each parameter&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_get_posteriors</span><span class="p">()</span>
        
        <span class="n">col</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">posterior_to_plot</span><span class="p">[</span><span class="mi">0</span><span class="p">][:])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">posterior_to_plot</span><span class="p">[</span><span class="mi">0</span><span class="p">][:])</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

        <span class="n">n</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">posterior_to_plot</span><span class="p">[:,</span><span class="n">n</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">posteriors_names</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">posteriors_names</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;log(L/L$</span><span class="se">\\</span><span class="s1">mathrm{_{</span><span class="se">\\</span><span class="s1">odot}}$)&#39;</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_best</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">posteriors_names</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>
        
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span></div>



<div class="viewcode-block" id="PlottingForMoSA.plot_radar">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.PlottingForMoSA.plot_radar">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_radar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranges</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Radar plot to check the distribution of the parameters.</span>
<span class="sd">        Useful to compare different models.</span>

<span class="sd">        Args:</span>
<span class="sd">            ranges     (list(tuple)): upper and lower limits for each parameters</span>
<span class="sd">            label              (str): (default = &#39;&#39;) label of the plot</span>
<span class="sd">            quantiles         (list): (default = (0.16, 0.5, 0.84)) mean +- sigma to report the posterior values</span>
<span class="sd">        Returns:</span>
<span class="sd">             fig, radar.ax    (object, object): matplotlib figure and radar class object       </span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ForMoSA - Radar plot&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_get_posteriors</span><span class="p">()</span>

        <span class="n">list_posteriors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">list_uncert_down</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">list_uncert_up</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">posterior_to_plot</span><span class="p">[</span><span class="mi">1</span><span class="p">,:])):</span>
            <span class="n">q16</span><span class="p">,</span> <span class="n">q50</span><span class="p">,</span> <span class="n">q84</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">posterior_to_plot</span><span class="p">[:,</span><span class="n">l</span><span class="p">],</span> <span class="n">quantiles</span><span class="p">)</span>
            
            <span class="n">list_posteriors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_best</span><span class="p">)</span>
            <span class="n">list_uncert_down</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q16</span><span class="p">)</span>
            <span class="n">list_uncert_up</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q84</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">radar</span> <span class="o">=</span> <span class="n">ComplexRadar</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">posteriors_names</span><span class="p">,</span> <span class="n">ranges</span><span class="p">)</span>

        <span class="n">radar</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">list_posteriors</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">radar</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">list_uncert_down</span><span class="p">,</span><span class="n">list_uncert_up</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="n">radar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.20</span><span class="p">),</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">radar</span><span class="o">.</span><span class="n">ax</span></div>



    <span class="k">def</span> <span class="nf">_get_spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">theta</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to get the data and best model asociated.</span>

<span class="sd">        Args:</span>
<span class="sd">            theta                   (list): best parameter values</span>
<span class="sd">        Returns:</span>
<span class="sd">            modif_spec_chi2  list(n-array): list containing the spectroscopic wavelength, spectroscopic fluxes of the data, </span>
<span class="sd">                                            spectroscopic errors of the data, spectroscopic fluxes of the model, </span>
<span class="sd">                                            photometric wavelength, photometric fluxes of the data, photometric errors of the data, </span>
<span class="sd">                                            spectroscopic fluxes of the model,</span>
<span class="sd">                                            planet transmission, star fluxes, systematics</span>
<span class="sd">            ck                list(floats): list scaling factor(s)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Get the posteriors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_posteriors</span><span class="p">()</span>

        <span class="c1"># Create a list for each spectra (obs and mod) for each observation + scaling factors</span>
        <span class="n">modif_spec_MOSAIC</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">CK</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">indobs</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">main_observation_path</span><span class="p">))):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">observation_path</span> <span class="o">=</span> <span class="n">obs</span>
            <span class="n">obs_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">observation_path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">spectrum_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">result_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;spectrum_obs_</span><span class="si">{</span><span class="n">obs_name</span><span class="si">}</span><span class="s1">.npz&#39;</span><span class="p">),</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">wav_obs_spectro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spectrum_obs</span><span class="p">[</span><span class="s1">&#39;obs_spectro_merge&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">flx_obs_spectro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spectrum_obs</span><span class="p">[</span><span class="s1">&#39;obs_spectro_merge&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">err_obs_spectro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spectrum_obs</span><span class="p">[</span><span class="s1">&#39;obs_spectro_merge&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">transm_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spectrum_obs</span><span class="p">[</span><span class="s1">&#39;obs_opt_merge&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">star_flx_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spectrum_obs</span><span class="p">[</span><span class="s1">&#39;obs_opt_merge&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">system_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spectrum_obs</span><span class="p">[</span><span class="s1">&#39;obs_opt_merge&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;obs_photo&#39;</span> <span class="ow">in</span> <span class="n">spectrum_obs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">wav_obs_photo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spectrum_obs</span><span class="p">[</span><span class="s1">&#39;obs_photo&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">flx_obs_photo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spectrum_obs</span><span class="p">[</span><span class="s1">&#39;obs_photo&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">err_obs_photo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">spectrum_obs</span><span class="p">[</span><span class="s1">&#39;obs_photo&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wav_obs_photo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">flx_obs_photo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">err_obs_photo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

            <span class="c1"># Recovery of the spectroscopy and photometry model</span>
            <span class="n">path_grid_spectro</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">adapt_store_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;adapted_grid_spectro_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">grid_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">obs_name</span><span class="si">}</span><span class="s1">_nonan.nc&#39;</span><span class="p">)</span>
            <span class="n">path_grid_photo</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">adapt_store_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;adapted_grid_photo_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">grid_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">obs_name</span><span class="si">}</span><span class="s1">_nonan.nc&#39;</span><span class="p">)</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">path_grid_spectro</span><span class="p">,</span> <span class="n">decode_cf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;netcdf4&#39;</span><span class="p">)</span>
            <span class="n">grid_spectro</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">]</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">path_grid_photo</span><span class="p">,</span> <span class="n">decode_cf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;netcdf4&#39;</span><span class="p">)</span>
            <span class="n">grid_photo</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">]</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">par3</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_spectro</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">flx_mod_spectro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">grid_spectro</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">par1</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">par2</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fill_value&quot;</span><span class="p">:</span> <span class="s2">&quot;extrapolate&quot;</span><span class="p">}))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flx_mod_spectro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_photo</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">flx_mod_photo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">grid_photo</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">par1</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">par2</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fill_value&quot;</span><span class="p">:</span> <span class="s2">&quot;extrapolate&quot;</span><span class="p">}))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flx_mod_photo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">par4</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_spectro</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">flx_mod_spectro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">grid_spectro</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">par1</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">par2</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">par3</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fill_value&quot;</span><span class="p">:</span> <span class="s2">&quot;extrapolate&quot;</span><span class="p">}))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flx_mod_spectro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_photo</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">flx_mod_photo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">grid_photo</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">par1</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">par2</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">par3</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fill_value&quot;</span><span class="p">:</span> <span class="s2">&quot;extrapolate&quot;</span><span class="p">}))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flx_mod_photo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">par5</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_spectro</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">flx_mod_spectro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">grid_spectro</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">par1</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">par2</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">par3</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">par4</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fill_value&quot;</span><span class="p">:</span> <span class="s2">&quot;extrapolate&quot;</span><span class="p">}))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flx_mod_spectro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_photo</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">flx_mod_photo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">grid_photo</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">par1</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">par2</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">par3</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">par4</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fill_value&quot;</span><span class="p">:</span> <span class="s2">&quot;extrapolate&quot;</span><span class="p">}))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flx_mod_photo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_spectro</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">flx_mod_spectro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">grid_spectro</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">par1</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">par2</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">par3</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">par4</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                                            <span class="n">par5</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                                                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fill_value&quot;</span><span class="p">:</span> <span class="s2">&quot;extrapolate&quot;</span><span class="p">}))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flx_mod_spectro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid_photo</span><span class="p">[</span><span class="s1">&#39;wavelength&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">flx_mod_photo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">grid_photo</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">par1</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">par2</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">par3</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">par4</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                                            <span class="n">par5</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                                                            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fill_value&quot;</span><span class="p">:</span> <span class="s2">&quot;extrapolate&quot;</span><span class="p">}))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flx_mod_photo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([])</span>

            <span class="c1"># Modification of the synthetic spectrum with the extra-grid parameters</span>
            <span class="n">modif_spec_chi2</span> <span class="o">=</span> <span class="n">modif_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_index</span><span class="p">,</span>
                                        <span class="n">wav_obs_spectro</span><span class="p">,</span> <span class="n">flx_obs_spectro</span><span class="p">,</span> <span class="n">err_obs_spectro</span><span class="p">,</span> <span class="n">flx_mod_spectro</span><span class="p">,</span>
                                        <span class="n">wav_obs_photo</span><span class="p">,</span> <span class="n">flx_obs_photo</span><span class="p">,</span> <span class="n">err_obs_photo</span><span class="p">,</span> <span class="n">flx_mod_photo</span><span class="p">,</span>
                                        <span class="n">transm_obs</span><span class="p">,</span> <span class="n">star_flx_obs</span><span class="p">,</span> <span class="n">system_obs</span><span class="p">,</span> <span class="n">indobs</span><span class="o">=</span><span class="n">indobs</span><span class="p">)</span>
            <span class="n">ck</span> <span class="o">=</span> <span class="n">modif_spec_chi2</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>

            <span class="n">modif_spec_MOSAIC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modif_spec_chi2</span><span class="p">)</span>
            <span class="n">CK</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ck</span><span class="p">)</span>

        <span class="n">modif_spec_chi2</span> <span class="o">=</span> <span class="n">modif_spec_MOSAIC</span>
        <span class="n">ck</span> <span class="o">=</span> <span class="n">CK</span>
        
        <span class="k">return</span> <span class="n">modif_spec_chi2</span><span class="p">,</span> <span class="n">ck</span>
    

<div class="viewcode-block" id="PlottingForMoSA.get_FULL_spectra">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.PlottingForMoSA.get_FULL_spectra">[docs]</a>
    <span class="k">def</span> <span class="nf">get_FULL_spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">grid_used</span> <span class="o">=</span> <span class="s1">&#39;original&#39;</span><span class="p">,</span> <span class="n">wavelengths</span><span class="o">=</span><span class="p">[],</span> <span class="n">N_points</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">re_interp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">int_method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Extract a model spectrum from another grid.</span>

<span class="sd">        Args:</span>
<span class="sd">            theta:                       (list): best parameter values</span>
<span class="sd">            grid_used:                    (str): (default = &#39;original&#39;) Path to the grid from where to extract the spectrum. If &#39;original&#39;, the current grid will be used.</span>
<span class="sd">            wavelengths:                 (list): (default = []) Desired wavelength range. If [] max and min values of wav_for_adapt range will be use to create the wavelength range.</span>
<span class="sd">            N_points:                     (int): (default = 1000) Number of points.</span>
<span class="sd">            re_interp:                (boolean): (default = False). Option to reinterpolate or not the grid.</span>
<span class="sd">            int_method:                   (str): (default = &quot;linear&quot;) Interpolation method for the grid (if reinterpolated).</span>
<span class="sd">        Returns:   </span>
<span class="sd">            wav_final                   (array): Wavelength array of the full model</span>
<span class="sd">            flx_final                   (array): Flux array of the full model</span>
<span class="sd">            ck                          (float): Scaling factor of the full model</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_get_posteriors</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Define the wavelength grid for the full spectra as resolution and wavelength range function</span>
            <span class="k">for</span> <span class="n">indobs</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">main_observation_path</span><span class="p">))):</span>
                <span class="n">my_string_ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">wav_for_adapt</span><span class="p">[</span><span class="n">indobs</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">wav_ind</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">my_string_ind</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">indobs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">wav</span> <span class="o">=</span> <span class="n">wav_ind</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">wav</span><span class="p">,</span> <span class="n">wav_ind</span><span class="p">))</span>
            <span class="n">wav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">wav</span><span class="p">)</span>
            <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">wav</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">wav</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">N_points</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">wavelengths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">N_points</span><span class="p">)</span>

        <span class="c1"># Recover the original grid</span>
        <span class="k">if</span> <span class="n">grid_used</span> <span class="o">==</span> <span class="s1">&#39;original&#39;</span><span class="p">:</span>
            <span class="n">path_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">model_path</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">path_grid</span> <span class="o">=</span> <span class="n">grid_used</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">path_grid</span><span class="p">,</span> <span class="n">decode_cf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;netcdf4&quot;</span><span class="p">)</span>

        <span class="c1"># Possibility of re-interpolating holes if the grid contains to much of them (WARNING: Very long process)</span>
        <span class="k">if</span> <span class="n">re_interp</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&gt; The possible holes in the grid are (re)interpolated: &#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key_ind</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]):</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key_ind</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])))</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">interpolate_na</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                            <span class="n">max_gap</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                
        <span class="n">wav_mod_nativ</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;wavelength&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">]</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">par3</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
            <span class="n">flx_mod_nativ</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">par1</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">par2</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">method</span><span class="o">=</span><span class="n">int_method</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fill_value&quot;</span><span class="p">:</span> <span class="s2">&quot;extrapolate&quot;</span><span class="p">})</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">par4</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
            <span class="n">flx_mod_nativ</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">par1</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">par2</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">par3</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">method</span><span class="o">=</span><span class="n">int_method</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fill_value&quot;</span><span class="p">:</span> <span class="s2">&quot;extrapolate&quot;</span><span class="p">})</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">par5</span> <span class="o">==</span> <span class="s1">&#39;NA&#39;</span><span class="p">:</span>
            <span class="n">flx_mod_nativ</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">par1</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">par2</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">par3</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">par4</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">method</span><span class="o">=</span><span class="n">int_method</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fill_value&quot;</span><span class="p">:</span> <span class="s2">&quot;extrapolate&quot;</span><span class="p">})</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flx_mod_nativ</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">par1</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">par2</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">par3</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">par4</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">par5</span><span class="o">=</span><span class="n">theta</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">method</span><span class="o">=</span><span class="n">int_method</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fill_value&quot;</span><span class="p">:</span> <span class="s2">&quot;extrapolate&quot;</span><span class="p">})</span>
        
        <span class="c1"># Interpolate to desire wavelength range</span>
        <span class="n">interp_mod_to_obs</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">wav_mod_nativ</span><span class="p">,</span> <span class="n">flx_mod_nativ</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
        <span class="n">flx_mod_final</span> <span class="o">=</span> <span class="n">interp_mod_to_obs</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">)</span>
        
        <span class="n">spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_spectra</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="c1"># WARNING : In case of multiple spectra, it is possible to work with different scaling factors. Here we only take the scaling factor of the first spectrum</span>
        <span class="c1">#in the MOSAIC (used for the plot_fit)</span>
        <span class="n">ck</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">wavelengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wavelengths</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flx_mod_final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">flx_mod_final</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">flx_mod_final_calib</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">flx_mod_final</span><span class="o">*</span><span class="n">ck</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="c1">#print(flx_mod_final[100],ck)</span>
        <span class="n">err_mod_final_calib</span> <span class="o">=</span> <span class="n">flx_mod_final_calib</span><span class="o">*</span><span class="mf">0.1</span>

        <span class="n">wav_final</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">flx_final</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">modif_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_index</span><span class="p">,</span>
                                                                                    <span class="n">wavelengths</span><span class="p">,</span> <span class="n">flx_mod_final_calib</span><span class="p">,</span> <span class="n">err_mod_final_calib</span><span class="p">,</span> <span class="n">flx_mod_final_calib</span><span class="o">/</span><span class="n">ck</span><span class="p">,</span>
                                                                                    <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[])</span>
    
        <span class="k">return</span> <span class="n">wav_final</span><span class="p">,</span> <span class="n">flx_final</span><span class="p">,</span> <span class="n">ck</span></div>



    
<div class="viewcode-block" id="PlottingForMoSA.plot_fit">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.PlottingForMoSA.plot_fit">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">uncert</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">logx</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plot the best fit comparing with the data.</span>

<span class="sd">        Args:</span>
<span class="sd">            figsize    (tuple): (default = (10, 5)) Size of the plot</span>
<span class="sd">            uncert     (str): (default = no) &#39;yes&#39; or &#39;no&#39; to plot spectra with associated error bars</span>
<span class="sd">            trans      (str): (default = no) &#39;yes&#39; or &#39;no&#39; to plot transmision curves for photometry</span>
<span class="sd">            logx       (str): (default = no) &#39;yes&#39; or &#39;no&#39; to plot the wavelength in log scale</span>
<span class="sd">            logy       (str): (default = no) &#39;yes&#39; or &#39;no&#39; to plot the flux in log scale</span>
<span class="sd">            norm       (str): (default = no) &#39;yes&#39; or &#39;no&#39; to plot the normalized spectra</span>
<span class="sd">        Returns:</span>
<span class="sd">            fig, ax, axr, axr2   (object, object, object, object): matplotlib figure and axes objects</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ForMoSA - Best fit and residuals plot&#39;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span><span class="n">rowspan</span><span class="o">=</span><span class="mi">5</span> <span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">axr</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span><span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span> <span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">axr2</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span><span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span> <span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

       
        <span class="n">spectra</span><span class="p">,</span> <span class="n">ck</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_spectra</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_best</span><span class="p">)</span>
        <span class="n">iobs_spectro</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iobs_photo</span> <span class="o">=</span> <span class="mi">0</span>
        

        <span class="c1"># Scale or not in absolute flux</span>
        <span class="k">if</span> <span class="n">norm</span> <span class="o">!=</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span> 
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>


        <span class="k">for</span> <span class="n">indobs</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">main_observation_path</span><span class="p">))):</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">use_lsqr</span><span class="p">[</span><span class="n">indobs</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
                <span class="c1"># If we used the lsq function, it means that our data is contaminated by the starlight difraction</span>
                <span class="c1"># so the model is the sum of the planet model + the estimated stellar contribution</span>
                <span class="n">spectra</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">spectra</span><span class="p">)</span> <span class="c1"># Transform spectra to a list so that we can modify its values</span>
                <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">])</span>
                <span class="n">model</span><span class="p">,</span> <span class="n">planet_contribution</span><span class="p">,</span> <span class="n">stellar_contribution</span><span class="p">,</span> <span class="n">star_flx</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">9</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">10</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span>
                <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">planet_contribution</span> <span class="o">*</span> <span class="n">model</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">stellar_contribution</span><span class="p">,</span> <span class="n">star_flx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                <span class="n">systematics</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">systematics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="n">systematics</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">iobs_spectro</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">iobs_photo</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">uncert</span><span class="o">==</span><span class="s1">&#39;yes&#39;</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>


                <span class="n">residuals</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">sigma_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="c1"># Replace np.std by np.nanstd if nans are in the array to ignore them</span>
                <span class="n">axr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">residuals</span><span class="o">/</span><span class="n">sigma_res</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
                <span class="n">axr</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
                <span class="n">axr2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">residuals</span><span class="o">/</span><span class="n">sigma_res</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span> <span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
                <span class="n">axr2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">handlelength</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">indobs</span> <span class="o">==</span> <span class="n">iobs_spectro</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Add labels out of the loops</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Spectroscopic data&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Spectroscopic model&#39;</span><span class="p">)</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Spectroscopic model-data&#39;</span><span class="p">)</span>
                    <span class="n">axr2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">residuals</span><span class="o">/</span><span class="n">sigma_res</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span> <span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;density&#39;</span><span class="p">)</span>
                    
                    <span class="n">iobs_spectro</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">iobs_photo</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">iobs_spectro</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># If you want to plot the transmission filters</span>
                <span class="k">if</span> <span class="n">trans</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">observation_path</span> <span class="o">=</span> <span class="n">obs</span>
                    <span class="n">obs_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">observation_path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">spectrum_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">result_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;spectrum_obs_</span><span class="si">{</span><span class="n">obs_name</span><span class="si">}</span><span class="s1">.npz&#39;</span><span class="p">),</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">obs_photo_ins</span> <span class="o">=</span> <span class="n">spectrum_obs</span><span class="p">[</span><span class="s1">&#39;obs_photo_ins&#39;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pho_ind</span><span class="p">,</span> <span class="n">pho</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs_photo_ins</span><span class="p">):</span>
                        <span class="n">path_list</span> <span class="o">=</span> <span class="vm">__file__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">separator</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
                        <span class="n">filter_pho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_list</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/phototeque/&#39;</span> <span class="o">+</span> <span class="n">pho</span> <span class="o">+</span> <span class="s1">&#39;.npz&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">filter_pho</span><span class="p">[</span><span class="s1">&#39;x_filt&#39;</span><span class="p">],</span> <span class="n">filter_pho</span><span class="p">[</span><span class="s1">&#39;y_filt&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.8</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">/</span><span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">]),</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">filter_pho</span><span class="p">[</span><span class="s1">&#39;x_filt&#39;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">filter_pho</span><span class="p">[</span><span class="s1">&#39;y_filt&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.4</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">/</span><span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">])),</span> <span class="n">pho</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">/</span> <span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">],</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">/</span> <span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">)</span>
                

                <span class="n">residuals_phot</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span><span class="o">-</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">sigma_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">residuals_phot</span><span class="p">)</span>
                <span class="n">axr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">residuals_phot</span><span class="o">/</span><span class="n">sigma_res</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
                <span class="n">axr</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">indobs</span> <span class="o">==</span> <span class="n">iobs_photo</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Add labels out of the loops</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Photometry data&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Photometry model&#39;</span><span class="p">)</span>
                    <span class="n">axr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Photometry model-data&#39;</span><span class="p">)</span>
                    
                    <span class="n">iobs_photo</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                    
        <span class="c1"># Set xlog-scale</span>
        <span class="k">if</span> <span class="n">logx</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">axr</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="c1"># Set xlog-scale</span>
        <span class="k">if</span> <span class="n">logy</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="c1"># Remove the xticks from the first ax</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="c1"># Labels</span>
        <span class="n">axr</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wavelength (Âµm)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">norm</span> <span class="o">!=</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span> 
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Flux (W m-2 Âµm-1)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Normalised flux (W m-2 Âµm-1)&#39;</span><span class="p">)</span>
        <span class="n">axr</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Residuals ($\sigma$)&#39;</span><span class="p">)</span>
        
        <span class="n">axr2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axr</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
        <span class="c1"># define the data as global</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span> <span class="o">=</span> <span class="n">spectra</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">axr</span><span class="p">,</span> <span class="n">axr2</span></div>

    
    
<div class="viewcode-block" id="PlottingForMoSA.plot_fit_HiRes">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.PlottingForMoSA.plot_fit_HiRes">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_fit_HiRes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">uncert</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">trans</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">logx</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Same as plot_fit but with the stellar and planetary models for high-resolution spectroscopy. Does not include residuals in a sub-axis.</span>

<span class="sd">        Args:</span>
<span class="sd">            figsize    (tuple): (default = (10, 5)) Size of the plot</span>
<span class="sd">            uncert     (str): (default = no) &#39;yes&#39; or &#39;no&#39; to plot spectra with associated error bars</span>
<span class="sd">            trans      (str): (default = no) &#39;yes&#39; or &#39;no&#39; to plot transmision curves for photometry</span>
<span class="sd">            logx       (str): (default = no) &#39;yes&#39; or &#39;no&#39; to plot the wavelength in log scale</span>
<span class="sd">            logy       (str): (default = no) &#39;yes&#39; or &#39;no&#39; to plot the flux in log scale</span>
<span class="sd">            norm       (str): (default = no) &#39;yes&#39; or &#39;no&#39; to plot the normalized spectra</span>
<span class="sd">        Returns:</span>
<span class="sd">            fig, ax   (object, object): matplotlib figure and axes objects</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ForMoSA - Best fit and residuals plot&#39;</span><span class="p">)</span>

        <span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
       
        <span class="n">spectra</span><span class="p">,</span> <span class="n">ck</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_spectra</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_best</span><span class="p">)</span>
        <span class="n">iobs_spectro</span> <span class="o">=</span> <span class="mi">0</span>
        

        <span class="c1"># Scale or not in absolute flux</span>
        <span class="k">if</span> <span class="n">norm</span> <span class="o">!=</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span> 
            <span class="n">ck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">indobs</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">main_observation_path</span><span class="p">))):</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">use_lsqr</span><span class="p">[</span><span class="n">indobs</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
                <span class="c1"># If we used the lsq function, it means that our data is contaminated by the starlight difraction</span>
                <span class="c1"># so the model is the sum of the planet model + the estimated stellar contribution</span>
                <span class="n">spectra</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">spectra</span><span class="p">)</span> <span class="c1"># Transform spectra to a list so that we can modify its values</span>
                <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">])</span>
                <span class="n">model</span><span class="p">,</span> <span class="n">planet_contribution</span><span class="p">,</span> <span class="n">stellar_contribution</span><span class="p">,</span> <span class="n">star_flx</span><span class="p">,</span> <span class="n">systematics</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">9</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">10</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">11</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span>
                <span class="n">transm</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">13</span><span class="p">]</span>
                <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">planet_contribution</span> <span class="o">*</span> <span class="n">model</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">stellar_contribution</span><span class="p">,</span> <span class="n">star_flx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">systematics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="n">systematics</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">iobs_spectro</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">uncert</span><span class="o">==</span><span class="s1">&#39;yes&#39;</span><span class="p">:</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">stellar_contribution</span><span class="p">,</span> <span class="n">star_flx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">planet_contribution</span> <span class="o">*</span> <span class="n">model</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>

 
                <span class="k">if</span> <span class="n">indobs</span> <span class="o">==</span> <span class="n">iobs_spectro</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Add labels out of the loops</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;residuals&#39;</span><span class="p">)</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;full model&#39;</span><span class="p">)</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;stellar model&#39;</span><span class="p">)</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;planetary model&#39;</span><span class="p">)</span>
                    
                    <span class="n">iobs_spectro</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># If you want to plot the transmission filters</span>
                <span class="k">if</span> <span class="n">trans</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">observation_path</span> <span class="o">=</span> <span class="n">obs</span>
                    <span class="n">obs_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">observation_path</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">spectrum_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">result_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;spectrum_obs_</span><span class="si">{</span><span class="n">obs_name</span><span class="si">}</span><span class="s1">.npz&#39;</span><span class="p">),</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">obs_photo_ins</span> <span class="o">=</span> <span class="n">spectrum_obs</span><span class="p">[</span><span class="s1">&#39;obs_photo_ins&#39;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pho_ind</span><span class="p">,</span> <span class="n">pho</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs_photo_ins</span><span class="p">):</span>
                        <span class="n">path_list</span> <span class="o">=</span> <span class="vm">__file__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                        <span class="n">separator</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
                        <span class="n">filter_pho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_list</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/phototeque/&#39;</span> <span class="o">+</span> <span class="n">pho</span> <span class="o">+</span> <span class="s1">&#39;.npz&#39;</span><span class="p">)</span>
                        <span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">filter_pho</span><span class="p">[</span><span class="s1">&#39;x_filt&#39;</span><span class="p">],</span> <span class="n">filter_pho</span><span class="p">[</span><span class="s1">&#39;y_filt&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.8</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">/</span><span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">]),</span><span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                        <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">filter_pho</span><span class="p">[</span><span class="s1">&#39;x_filt&#39;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">filter_pho</span><span class="p">[</span><span class="s1">&#39;y_filt&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">0.4</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">/</span><span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">])),</span> <span class="n">pho</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">/</span><span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">],</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span><span class="o">/</span><span class="n">ck</span><span class="p">[</span><span class="n">indobs</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">)</span>
                

                <span class="n">residuals_phot</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span><span class="o">-</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">sigma_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">residuals_phot</span><span class="p">)</span>


                <span class="k">if</span> <span class="n">indobs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Add labels out of the loops</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Photometry data&#39;</span><span class="p">)</span>
                    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Photometry model&#39;</span><span class="p">)</span>

        <span class="c1"># Set xlog-scale</span>
        <span class="k">if</span> <span class="n">logx</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="c1"># Set xlog-scale</span>
        <span class="k">if</span> <span class="n">logy</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="c1"># Remove the xticks from the first ax</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="c1"># Labels</span>
        <span class="k">if</span> <span class="n">norm</span> <span class="o">!=</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span> 
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Flux (ADU)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Normalised flux (W m-2 Âµm-1)&#39;</span><span class="p">)</span>
            
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;wavelength ($ \mu $m)&#39;</span><span class="p">)</span>
        
        <span class="n">fig1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">result_path</span> <span class="o">+</span> <span class="s1">&#39;full_data.pdf&#39;</span><span class="p">)</span>

        <span class="c1"># define the data as global</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span> <span class="o">=</span> <span class="n">spectra</span>

        <span class="k">return</span> <span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span></div>

    
    
<div class="viewcode-block" id="PlottingForMoSA.plot_HiRes_comp_model">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.PlottingForMoSA.plot_HiRes_comp_model">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_HiRes_comp_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">data_resolution</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Specific function to plot the best fit comparing with the data for high-resolution spectroscopy.</span>

<span class="sd">        Args:</span>
<span class="sd">            figsize             (tuple): (default = (10, 5)) Size of the plot</span>
<span class="sd">            norm                  (str): (default = no) &#39;yes&#39; or &#39;no&#39; to plot the normalized spectra</span>
<span class="sd">            data_resolution       (int): (default = 0) Custom resolution to broadened data</span>
<span class="sd">        Returns:</span>
<span class="sd">            fig1, ax1  (object, object): matplotlib figure and axes objects</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ForMoSA - Planet model and data&#39;</span><span class="p">)</span>
       
        <span class="n">spectra</span><span class="p">,</span> <span class="n">ck</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_spectra</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_best</span><span class="p">)</span>
        <span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">)</span>

        <span class="c1"># Scale or not in absolute flux</span>
        <span class="k">if</span> <span class="n">norm</span> <span class="o">!=</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span> 
            <span class="n">ck</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
            
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">PdfPages</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">result_path</span> <span class="o">+</span> <span class="s1">&#39;PLanet_model_and_data_resolution_degraded.pdf&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
        

        <span class="k">for</span> <span class="n">indobs</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">main_observation_path</span><span class="p">))):</span>
            
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">use_lsqr</span><span class="p">[</span><span class="n">indobs</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
                <span class="c1"># If we used the lsq function, it means that our data is contaminated by the starlight difraction</span>
                <span class="c1"># so the model is the sum of the planet model + the estimated stellar contribution</span>
                <span class="n">spectra</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">spectra</span><span class="p">)</span> <span class="c1"># Transform spectra to a list so that we can modify its values</span>
                <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">])</span>
                <span class="n">model</span><span class="p">,</span> <span class="n">planet_contribution</span><span class="p">,</span> <span class="n">stellar_contribution</span><span class="p">,</span> <span class="n">star_flx</span><span class="p">,</span> <span class="n">systematics</span><span class="p">,</span> <span class="n">transm</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">9</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">10</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">11</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">12</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">13</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">systematics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">star_flx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">stellar_contribution</span><span class="p">,</span> <span class="n">star_flx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">systematics</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">star_flx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>     <span class="c1"># if len(systematics) = 0 but len(star_flx) &gt; 0</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">stellar_contribution</span><span class="p">,</span> <span class="n">star_flx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">systematics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>  <span class="c1"># if len(star_flx) = 0 but len(systematics) &gt; 0</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">systematics</span>
                <span class="k">else</span><span class="p">:</span>                         <span class="c1"># if len(star_flx) = 0 and len(systematics) = 0</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">wave</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">planet_model</span> <span class="o">=</span> <span class="n">planet_contribution</span> <span class="o">*</span> <span class="n">model</span> 
                
                <span class="c1"># Compute intrinsic resolution of the data because of the v.sini</span>
                <span class="n">resolution</span> <span class="o">=</span> <span class="mf">3.0</span><span class="o">*</span><span class="mf">1e5</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_best</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_index</span> <span class="o">==</span> <span class="s1">&#39;vsini&#39;</span><span class="p">])</span>
                <span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">))</span>
                
                <span class="k">if</span> <span class="n">data_resolution</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">custom_reso</span><span class="p">[</span><span class="n">indobs</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
                    <span class="n">resolution_data</span> <span class="o">=</span> <span class="n">data_resolution</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">))</span>
                    <span class="n">data_broadened</span> <span class="o">=</span> <span class="n">vsini_fct_accurate</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_best</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_index</span> <span class="o">==</span> <span class="s1">&#39;vsini&#39;</span><span class="p">])</span>
                    <span class="n">data_broadened</span> <span class="o">=</span> <span class="n">resolution_decreasing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="p">[],</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">resolution_data</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">)</span>
                    <span class="n">planet_model_broadened</span> <span class="o">=</span> <span class="n">resolution_decreasing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="p">[],</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">planet_model</span><span class="p">,</span> <span class="n">resolution_data</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">)</span>
       
                
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="s1">&#39;comp_model&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">data_broadened</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">planet_model_broadened</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;wavelength ($\mu$m)&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux (ADU)&#39;</span><span class="p">)</span>
                
                <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">planet_model</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">use_lsqr</span><span class="p">[</span><span class="n">indobs</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
                    <span class="n">legend_data</span> <span class="o">=</span> <span class="s1">&#39;data - star&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">legend_data</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span>
                    
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">legend_data</span><span class="p">,</span> <span class="s1">&#39;planet model&#39;</span><span class="p">])</span>
                
                <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">()</span>
                
        <span class="n">pdf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">legend_data</span><span class="p">,</span> <span class="s2">&quot;planet model&quot;</span><span class="p">],</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">18</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;wavelength ($ \mu $m)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flux (ADU)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">result_path</span> <span class="o">+</span> <span class="s1">&#39;Planet_model_and_data.pdf&#39;</span><span class="p">)</span>
                            
        <span class="k">return</span> <span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span></div>

    
    
<div class="viewcode-block" id="PlottingForMoSA.plot_ccf">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.PlottingForMoSA.plot_ccf">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_ccf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">rv_grid</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span><span class="mi">300</span><span class="p">],</span> <span class="n">rv_step</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">window_normalisation</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">model_wavelength</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">model_spectra</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">model_resolution</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;Full&#39;</span><span class="p">,</span> <span class="n">rv_cor</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plot the cross-correlation function. It is used for high resolution spectroscopy.</span>

<span class="sd">        Args:</span>
<span class="sd">            figsize                   (tuple): (default = (10, 5)) Size of the plot</span>
<span class="sd">            rv_grid                    (list): (default = [-300,300]) Maximum and minumum values of the radial velocity shift (in km/s)</span>
<span class="sd">            rv_step                   (float): (default = 0.5) Radial velocity shift steps (in km/s)</span>
<span class="sd">            window_normalisation        (int): (default = 100) ?</span>
<span class="sd">            model_wavelength           (list): (default = []) ?</span>
<span class="sd">            model_spectra =            (list): (default = []) ?</span>
<span class="sd">            model_resolution           (list): (default = []) ?</span>
<span class="sd">            model_name                  (str): (default = &#39;Full&#39;) ?</span>
<span class="sd">            rv_cor                      (int): (default = 0) ?</span>
<span class="sd">        Returns:</span>
<span class="sd">            fig1, ax1        (object, object): Matplotlib figure and axes objects</span>
<span class="sd">            rv_grid                    (list): Radial velocity grid</span>
<span class="sd">            ccf                        (list): Cross-correlation function</span>
<span class="sd">            acf                        (list): Auto-correlation function  </span>

<span class="sd">        Author: Allan Denis</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ForMoSA - CCF plot&#39;</span><span class="p">)</span>
        
        
        <span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        
        <span class="n">rv_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">rv_grid</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rv_grid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rv_step</span><span class="p">)</span>
        <span class="n">ccf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">acf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        
        <span class="n">spectra</span><span class="p">,</span> <span class="n">ck</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_spectra</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_best</span><span class="p">)</span>
        
        <span class="n">model_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">wave_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">err_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">transm_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        
        <span class="k">for</span> <span class="n">indobs</span><span class="p">,</span> <span class="n">obs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">main_observation_path</span><span class="p">))):</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">use_lsqr</span><span class="p">[</span><span class="n">indobs</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
                <span class="c1"># If we used the lsq function, it means that our data is contaminated by the starlight difraction</span>
                <span class="c1"># so the model is the sum of the planet model + the estimated stellar contribution</span>
                <span class="n">spectra</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">spectra</span><span class="p">)</span> <span class="c1"># Transform spectra to a list so that we can modify its values</span>
                <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">])</span>
                <span class="n">wavelength</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">stellar_contribution</span><span class="p">,</span> <span class="n">star_flx</span><span class="p">,</span> <span class="n">systematics</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">10</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">11</span><span class="p">],</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span>
                <span class="n">transm</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">13</span><span class="p">]</span>
     

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>

                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">systematics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">star_flx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">stellar_contribution</span><span class="p">,</span> <span class="n">star_flx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">systematics</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">star_flx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>     <span class="c1"># if len(systematics) = 0 but len(star_flx) &gt; 0</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">stellar_contribution</span><span class="p">,</span> <span class="n">star_flx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">systematics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>  <span class="c1"># if len(star_flx) = 0 but len(systematics) &gt; 0</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">systematics</span>
                <span class="k">else</span><span class="p">:</span>                         <span class="c1"># if len(star_flx) = 0 and len(systematics) = 0</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">doppler_fct</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_best</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_index</span> <span class="o">==</span> <span class="s1">&#39;rv&#39;</span><span class="p">])</span>
                    
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_spectra</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">model_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_array</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">obs_spectro</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">adapt_observation_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="p">,</span> <span class="n">indobs</span><span class="o">=</span><span class="n">indobs</span><span class="p">)</span>
                    <span class="n">res_obs</span> <span class="o">=</span> <span class="n">obs_spectro</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">res_obs_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">obs_spectro</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">res_obs</span><span class="p">,</span> <span class="n">fill_value</span> <span class="o">=</span> <span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
                    <span class="n">res_obs</span> <span class="o">=</span> <span class="n">res_obs_interp</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
                    
                    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">model_wavelength</span> <span class="o">&gt;=</span> <span class="n">wavelength</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">model_wavelength</span> <span class="o">&lt;=</span> <span class="n">wavelength</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">model_wavelength_adapt</span><span class="p">,</span> <span class="n">model_resolution_adapt</span><span class="p">,</span> <span class="n">model_spectra_adapt</span> <span class="o">=</span> <span class="n">model_wavelength</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">model_resolution</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">model_spectra</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                    <span class="n">model_resolution_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">model_wavelength_adapt</span><span class="p">,</span> <span class="n">model_resolution_adapt</span><span class="p">,</span> <span class="n">fill_value</span> <span class="o">=</span> <span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
                    <span class="n">model_resolution_adapt</span> <span class="o">=</span> <span class="n">model_resolution_interp</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span>
                    <span class="n">model_adapted</span> <span class="o">=</span> <span class="n">resolution_decreasing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">,</span> <span class="p">[],</span> <span class="n">res_obs</span><span class="p">,</span> <span class="n">model_wavelength_adapt</span><span class="p">,</span> <span class="n">model_spectra_adapt</span><span class="p">,</span> <span class="n">model_resolution_adapt</span><span class="p">,</span>
                                                        <span class="s1">&#39;mod&#39;</span><span class="p">,</span> <span class="n">indobs</span><span class="o">=</span><span class="n">indobs</span><span class="p">)</span>
                    
                    
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">transm</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">model_adapted</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">lsq_fct</span><span class="p">(</span><span class="n">spectra</span><span class="p">[</span><span class="n">indobs</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">err</span><span class="p">,</span> <span class="n">star_flx</span><span class="p">,</span> <span class="n">transm</span><span class="p">,</span> <span class="n">model_adapted</span><span class="p">,</span> <span class="n">systematics</span><span class="p">)</span>
                        
                    <span class="n">model_adapted</span> <span class="o">=</span> <span class="n">vsini_fct_accurate</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">model_adapted</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_best</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_index</span><span class="o">==</span><span class="s1">&#39;vsini&#39;</span><span class="p">])</span>
                    
                    <span class="n">model_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_array</span><span class="p">,</span> <span class="n">model_adapted</span><span class="p">)</span>
                
                <span class="n">wave_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wave_array</span><span class="p">,</span> <span class="n">wavelength</span><span class="p">)</span>
                <span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_array</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="n">transm_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transm_array</span><span class="p">,</span> <span class="n">transm</span><span class="p">)</span>
                <span class="n">err_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err_array</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

        <span class="n">max_ccf</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">rv</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">rv_grid</span><span class="p">):</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">model_doppler</span> <span class="o">=</span> <span class="n">doppler_fct</span><span class="p">(</span><span class="n">wave_array</span><span class="p">,</span> <span class="n">data_array</span><span class="p">,</span> <span class="n">err_array</span><span class="p">,</span> <span class="n">model_array</span><span class="p">,</span> <span class="n">rv</span><span class="o">+</span><span class="n">rv_cor</span><span class="p">)</span>
            <span class="n">ccf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ccf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">model_doppler</span> <span class="o">*</span> <span class="n">data_array</span><span class="p">))</span>
            <span class="n">acf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">model_doppler</span> <span class="o">*</span> <span class="n">model_array</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">model_doppler</span> <span class="o">*</span> <span class="n">data_array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_ccf</span><span class="p">:</span>
                <span class="n">max_ccf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">model_doppler</span> <span class="o">*</span> <span class="n">data_array</span><span class="p">)</span>
                <span class="n">model_max_ccf</span> <span class="o">=</span> <span class="n">model_doppler</span>
            
        <span class="c1"># Rescaling cross-correlation function to estimate a SNR</span>
        <span class="n">acf_norm</span> <span class="o">=</span> <span class="n">acf</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">acf</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rv_grid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">window_normalisation</span><span class="p">)])</span>
        <span class="n">ccf_norm</span> <span class="o">=</span> <span class="n">ccf</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">ccf</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rv_grid</span><span class="o">-</span><span class="n">rv_grid</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ccf</span><span class="p">)])</span> <span class="o">&gt;</span> <span class="n">window_normalisation</span><span class="p">)])</span>
        <span class="n">ccf_noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ccf_norm</span><span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">rv_grid</span><span class="o">-</span><span class="n">rv_grid</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ccf</span><span class="p">)])</span> <span class="o">&gt;</span> <span class="n">window_normalisation</span><span class="p">)])</span>
        <span class="n">ccf_norm</span> <span class="o">=</span> <span class="n">ccf_norm</span> <span class="o">/</span> <span class="n">ccf_noise</span>
        
        <span class="c1"># Rescaling autocorrelation function to make comparable with cross-correlation function</span>
        <span class="n">acf_norm</span> <span class="o">=</span> <span class="n">acf_norm</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">acf_norm</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ccf_norm</span><span class="p">)</span>
        
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rv_grid</span><span class="p">,</span> <span class="n">ccf_norm</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;ccf&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rv_grid</span> <span class="o">+</span> <span class="n">rv_grid</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ccf_norm</span><span class="p">)]</span> <span class="o">+</span> <span class="n">rv_cor</span><span class="p">,</span> <span class="n">acf_norm</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">rv_grid</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ccf_norm</span><span class="p">)],</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;C3&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;RV (km/s)&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;S/N&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;ccf&#39;</span><span class="p">,</span> <span class="s1">&#39;acf&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;SNR = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ccf_norm</span><span class="p">)</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">, RV = </span><span class="si">{</span><span class="n">rv_grid</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ccf_norm</span><span class="p">)]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> km/s&#39;</span><span class="p">)</span>
        <span class="c1">#ax1.set_title(f&#39;SNR = {np.nanmax(ccf_norm):.1f}, RV = {rv_grid[np.argmax(ccf_norm)]:.1f} km/s&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">fig1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">result_path</span> <span class="o">+</span> <span class="s1">&#39;ccf_&#39;</span> <span class="o">+</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">rv_grid</span><span class="p">,</span> <span class="n">ccf</span><span class="p">,</span> <span class="n">acf</span></div>

    


    
<div class="viewcode-block" id="PlottingForMoSA.plot_PT">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.PlottingForMoSA.plot_PT">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_PT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_temp_profile</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;ExoREM&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to plot the Pressure-Temperature profiles.</span>
<span class="sd">        Adpated from Nathan Zimniak.</span>

<span class="sd">        Args:</span>
<span class="sd">            path_temp_profile    (str): Path to the temperature profile grid</span>
<span class="sd">            figsize            (tuple): (default = (6, 5)) Size of the plot</span>
<span class="sd">            model                (str): (default = &#39;ExoREM&#39;) Name of the model grid</span>
<span class="sd">        Returns:</span>
<span class="sd">            fig, ax (object, object): Matplotlib figure and axes objects</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ForMoSA - Pressure-Temperature profile&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">result_path</span> <span class="o">+</span> <span class="s1">&#39;/result_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">ns_algo</span> <span class="o">+</span> <span class="s1">&#39;.pic&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f1</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
            <span class="c1"># samples = result.samples</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span>

        <span class="c1"># put nans where data is not realistic</span>
        <span class="n">out</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">400</span> <span class="ow">or</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">3.00</span> <span class="ow">or</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">5.00</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">elif</span> <span class="mi">10</span><span class="o">**</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.32</span> <span class="ow">or</span> <span class="mi">10</span><span class="o">**</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">10.00</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.10</span> <span class="ow">or</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.80</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
        <span class="c1">#CrÃ©e une liste pour chaque paramÃ¨tre</span>
        <span class="n">Teffs</span><span class="p">,</span> <span class="n">loggs</span><span class="p">,</span> <span class="n">MHs</span><span class="p">,</span> <span class="n">COs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ATMO&#39;</span><span class="p">:</span>
            <span class="n">gammas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)):</span>
            <span class="n">Teffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">loggs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ExoREM&#39;</span><span class="p">:</span>
                <span class="n">MHs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
                <span class="n">COs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ATMO&#39;</span><span class="p">:</span>
                <span class="n">MHs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">COs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
                <span class="n">gammas</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>

        <span class="c1">#Charge la grille de profils de tempÃ©rature</span>
        <span class="n">temperature_grid_xa</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">path_temp_profile</span><span class="p">)</span>
        <span class="c1">#CrÃ©e les profils de tempÃ©rature associÃ©s aux points de la grille</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">temperature_grid_xa</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
        <span class="n">temperature_profiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ExoREM&#39;</span><span class="p">:</span>
                <span class="n">temperature_profiles</span><span class="p">[</span><span class="n">i</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">temperature_grid_xa</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">Teff</span><span class="o">=</span><span class="n">Teffs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">logg</span><span class="o">=</span><span class="n">loggs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">MH</span><span class="o">=</span><span class="n">MHs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">CO</span><span class="o">=</span><span class="n">COs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="c1">#, kwargs={&#39;fill_value&#39;:&#39;extrapolate&#39;})</span>
            <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ATMO&#39;</span><span class="p">:</span>
                <span class="n">temperature_profiles</span><span class="p">[</span><span class="n">i</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">temperature_grid_xa</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">Teff</span><span class="o">=</span><span class="n">Teffs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">logg</span><span class="o">=</span><span class="n">loggs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">MH</span><span class="o">=</span><span class="n">MHs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">CO</span><span class="o">=</span><span class="n">COs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gammas</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="c1">#, kwargs={&#39;fill_value&#39;:&#39;extrapolate&#39;})</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ATMO&#39;</span><span class="p">:</span>
            <span class="c1">#Calcule le 2eme facteur de robustesse (pour ATMO)</span>
            <span class="n">nbNans</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">temperature_profiles</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">temperature_profiles</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">temperature_profiles</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;nan&quot;</span><span class="p">:</span>
                        <span class="n">nbNans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nbNans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">FdR2</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nbNans</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
            <span class="n">FdR1</span> <span class="o">=</span> <span class="n">temperature_grid_xa</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Facteur de robustesse 1&#39;</span><span class="p">]</span>
            <span class="n">FdR</span> <span class="o">=</span> <span class="n">FdR1</span><span class="o">*</span><span class="n">FdR2</span>
            <span class="c1">#Extrapole les tempÃ©ratures</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)):</span>
                <span class="n">newT</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">temperature_profiles</span><span class="p">[</span><span class="n">i</span><span class="p">][:]),</span> <span class="p">[(</span><span class="s1">&#39;pressure&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">P</span><span class="p">)))])</span>
                <span class="n">newT</span> <span class="o">=</span> <span class="n">newT</span><span class="o">.</span><span class="n">interpolate_na</span><span class="p">(</span><span class="n">dim</span> <span class="o">=</span> <span class="s1">&#39;pressure&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
                <span class="n">temperature_profiles</span><span class="p">[</span><span class="n">i</span><span class="p">][:]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">newT</span><span class="p">)</span>
        <span class="c1">#Calcule le profil le plus probable</span>
        <span class="n">Tfit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)):</span>
            <span class="n">Tfit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">temperature_profiles</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="mi">50</span><span class="p">))</span>
        <span class="c1">#Calcule les percentiles 68 et 96 du profil le plus probable</span>
        <span class="n">Tinf68</span><span class="p">,</span> <span class="n">Tsup68</span><span class="p">,</span> <span class="n">Tinf95</span><span class="p">,</span> <span class="n">Tsup95</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)):</span>
            <span class="n">Tinf68</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">temperature_profiles</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="mi">16</span><span class="p">))</span>
            <span class="n">Tsup68</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">temperature_profiles</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="mi">84</span><span class="p">))</span>
            <span class="n">Tinf95</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">temperature_profiles</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">Tsup95</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">temperature_profiles</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="mi">98</span><span class="p">))</span>
        <span class="c1">#Plot le profil le plus probable et les percentiles associÃ©s</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Tinf95</span><span class="p">,</span> <span class="n">Tsup95</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;2 $\sigma$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Tinf68</span><span class="p">,</span> <span class="n">Tsup68</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;1 $\sigma$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tfit</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Best fit&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">P</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">P</span><span class="p">)])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Temperature (K)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure (Pa)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>

       

<div class="viewcode-block" id="PlottingForMoSA.plot_Clouds">
<a class="viewcode-back" href="../../../plotting.html#ForMoSA.plotting.plotting_class.PlottingForMoSA.plot_Clouds">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_Clouds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cloud_prop</span><span class="p">,</span> <span class="n">path_cloud_profile</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Function to plot cloud profiles.</span>
<span class="sd">        Adapted from Nathan Zimniak</span>

<span class="sd">        Args: </span>
<span class="sd">            cloud_prop (str) : Choose the cloud species. The options are</span>
<span class="sd">                                [&#39;eddy_diffusion_coefficient&#39;,</span>
<span class="sd">                                &#39;vmr_CH4&#39;,</span>
<span class="sd">                                &#39;vmr_CO&#39;,</span>
<span class="sd">                                &#39;vmr_CO2&#39;,</span>
<span class="sd">                                &#39;vmr_FeH&#39;,</span>
<span class="sd">                                &#39;vmr_H2O&#39;,</span>
<span class="sd">                                &#39;vmr_H2S&#39;,</span>
<span class="sd">                                &#39;vmr_HCN&#39;,</span>
<span class="sd">                                &#39;vmr_K&#39;,</span>
<span class="sd">                                &#39;vmr_Na&#39;,</span>
<span class="sd">                                &#39;vmr_NH3&#39;,</span>
<span class="sd">                                &#39;vmr_PH3&#39;,</span>
<span class="sd">                                &#39;vmr_TiO&#39;,</span>
<span class="sd">                                &#39;vmr_VO&#39;,</span>
<span class="sd">                                &#39;cloud_opacity_Fe&#39;,</span>
<span class="sd">                                &#39;cloud_opacity_Mg2SiO4&#39;,</span>
<span class="sd">                                &#39;cloud_particle_radius_Fe&#39;,</span>
<span class="sd">                                &#39;cloud_particle_radius_Mg2SiO4&#39;,</span>
<span class="sd">                                &#39;cloud_vmr_Fe&#39;,</span>
<span class="sd">                                &#39;cloud_vmr_Mg2SiO4&#39;]</span>
<span class="sd">        Returns:</span>
<span class="sd">            fig, ax (object, object): Matplotlib figure and axes objects</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ForMoSA - Cloud profile&#39;</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">result_path</span> <span class="o">+</span> <span class="s1">&#39;/result_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_params</span><span class="o">.</span><span class="n">ns_algo</span> <span class="o">+</span> <span class="s1">&#39;.pic&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f1</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
            <span class="c1"># samples = result.samples</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;samples&#39;</span><span class="p">]</span>

        <span class="c1">#Supprime les points hors de la grille</span>
        <span class="n">out</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">400</span> <span class="ow">or</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">3.00</span> <span class="ow">or</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">5.00</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">elif</span> <span class="mi">10</span><span class="o">**</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.32</span> <span class="ow">or</span> <span class="mi">10</span><span class="o">**</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">10.00</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.10</span> <span class="ow">or</span> <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.80</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
        <span class="c1">#CrÃ©e une liste pour chaque paramÃ¨tre</span>
        <span class="n">Teffs</span><span class="p">,</span> <span class="n">loggs</span><span class="p">,</span> <span class="n">MHs</span><span class="p">,</span> <span class="n">COs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)):</span>
            <span class="n">Teffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">loggs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">MHs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">COs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="c1">#Charge la grille de profils d&#39;une propriÃ©tÃ© d&#39;un nuage</span>
        <span class="n">cloud_props_grids_xa</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">path_cloud_profile</span><span class="p">)</span>
        <span class="n">cloud_prop_grid_xa</span> <span class="o">=</span> <span class="n">cloud_props_grids_xa</span><span class="p">[</span><span class="s1">&#39;P_&#39;</span> <span class="o">+</span> <span class="n">cloud_prop</span><span class="p">]</span>
        <span class="c1">#CrÃ©e les profils d&#39;une propriÃ©tÃ© d&#39;un nuage associÃ©s aux points de la grille</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">cloud_prop_grid_xa</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
        <span class="n">cloud_prop_profiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)):</span>
            <span class="n">cloud_prop_profiles</span><span class="p">[</span><span class="n">i</span><span class="p">][:]</span> <span class="o">=</span> <span class="n">cloud_prop_grid_xa</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">Teff</span><span class="o">=</span><span class="n">Teffs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">logg</span><span class="o">=</span><span class="n">loggs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">MH</span><span class="o">=</span><span class="n">MHs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">CO</span><span class="o">=</span><span class="n">COs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="c1">#, kwargs={&#39;fill_value&#39;:&#39;extrapolate&#39;})</span>
        <span class="c1"># Calcule le profil le plus probable</span>
        <span class="n">propfit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)):</span>
            <span class="n">propfit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">cloud_prop_profiles</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="mi">50</span><span class="p">))</span>
        <span class="c1"># Calcule les percentiles 68 et 96 du profil le plus probable</span>
        <span class="n">propinf68</span><span class="p">,</span> <span class="n">propsup68</span><span class="p">,</span> <span class="n">propinf95</span><span class="p">,</span> <span class="n">propsup95</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)):</span>
            <span class="n">propinf68</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">cloud_prop_profiles</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="mi">16</span><span class="p">))</span>
            <span class="n">propsup68</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">cloud_prop_profiles</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="mi">84</span><span class="p">))</span>
            <span class="n">propinf95</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">cloud_prop_profiles</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">propsup95</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">cloud_prop_profiles</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="mi">98</span><span class="p">))</span>

        <span class="c1"># Plot le profil le plus probable et les percentiles associÃ©s</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">propinf95</span><span class="p">,</span> <span class="n">propsup95</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;2 $\sigma$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">propinf68</span><span class="p">,</span> <span class="n">propsup68</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;1 $\sigma$&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">propfit</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color_out</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Best fit&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">P</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">P</span><span class="p">)])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Temperature (K)&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;eddy_diffusion_coefficient&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Eddy diffusion coefficient ($m^2.s^{-1}$)&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;vmr_CH4&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$CH_4$ volume mixing ratio&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;vmr_CO&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;CO volume mixing ratio&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;vmr_CO2&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$CO_2$ volume mixing ratio&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;vmr_FeH&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;FeH volume mixing ratio&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;vmr_H2O&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$H_2O$ volume mixing ratio&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;vmr_H2S&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$H_2S$ volume mixing ratio&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;vmr_HCN&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;HCN volume mixing ratio&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;vmr_K&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;K volume mixing ratio&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;vmr_Na&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Na volume mixing ratio&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;vmr_NH3&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$NH_3$ volume mixing ratio&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;vmr_PH3&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$PH_3$ volume mixing ratio&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;vmr_TiO&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;TiO volume mixing ratio&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;vmr_VO&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;VO volume mixing ratio&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;cloud_opacity_Fe&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Fe cloud opacity&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;cloud_opacity_Mg2SiO4&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$Mg_2SiO_4$ cloud opacity&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;cloud_particle_radius_Fe&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Fe cloud particle radius (m)&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;cloud_particle_radius_Mg2SiO4&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$Mg_2SiO_4$ cloud particle radius (m)&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;cloud_vmr_Fe&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Fe cloud volume mixing ratio&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cloud_prop</span> <span class="o">==</span> <span class="s1">&#39;cloud_vmr_Mg2SiO4&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$Mg_2SiO_4$ cloud volume mixing ratio&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure (Pa)&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>
</div>

    


</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Simon Petrus, Paulina Palma-Bifani, Matthieu Ravet, Allan Denis, MickaÃ«l Bonnefoy and GaÃ«l Chauvin.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>